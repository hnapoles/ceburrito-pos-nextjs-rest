generator client {
  provider = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "pos", "core"]  // Add all schemas used in the project
}

model Session {
  id           String   @id @default(cuid())
  expires      DateTime
  userId       String   @map("user_id")
  sessionToken String   @unique @map("user_token")
  user         AppUser  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
  @@schema("core")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_token")
  @@schema("core")
}

model AppUser {
  id            String    @id @default(cuid())
  name          String
  email         String    @unique
  password      String
  emailVerified DateTime? @map("email_verified")
  imageUrl      String?   @map("image_url")
  primaryRole   String    @default("user") @map("primary_role")
  createdBy     String    @map("created_by")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedBy     String    @map("updated_by")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  sessions      Session[]

  @@map("app_user")
  @@schema("core")
}

model AppLookup {
  id    String  @id @default(cuid()) 
  name  String
  description String
  code String
  variable String
  value String
  sortSeq Int @default(0) @map("sort_seq")
  enabled Boolean @default(true)
  createdBy     String    @map("created_by")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedBy     String    @map("updated_by")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  
  @@map("app_lookup")
  @@schema("core")

}

model AppRole {
  id          String              @id @default(cuid())
  name        String
  description String?
  isSuperUser Boolean             @default(false) @map("is_super_user")
  createdBy   String              @map("created_by")
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedBy   String              @map("updated_by")
  updatedAt   DateTime            @updatedAt @map("updated_at")
  permissions AppRolePermission[]

  @@map("app_role")
  @@schema("core")
}

model AppPermission {
  id        String              @id @default(cuid())
  name      String
  createdBy String              @map("created_by")
  createdAt DateTime            @default(now()) @map("created_at")
  updatedBy String              @map("updated_by")
  updatedAt DateTime            @updatedAt @map("updated_at")
  roles     AppRolePermission[]

  @@map("app_permission")
  @@schema("core")
}

model AppRolePermission {
  id           String        @id @default(cuid())
  roleId       String        @map("role_id")
  permissionId String        @map("permissions_id")
  createdBy    String        @map("created_by")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedBy    String        @map("updated_by")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  permission   AppPermission @relation(fields: [permissionId], references: [id])
  role         AppRole       @relation(fields: [roleId], references: [id])

  @@map("app_role_permission")
  @@schema("core")
}

model Customer {
  id            String    @id @default(cuid()) 
  name          String?
  email         String?
  emailVerified DateTime? @map("email_verified")
  createdBy     String    @map("created_by")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedBy     String    @map("updated_by")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  orders        Order[]

  @@map("customer")
  @@schema("pos")
}



model Product {
  id          String        @id @default(cuid()) 
  name        String
  description String
  imageUrl    String? @map("image_url")
  price       Float
  activeAt    DateTime?     @map("active_at")
  archivedAt  DateTime?     @map("archived_at")
  category    String
  status      ProductStatus
  createdBy    String   @map("created_by")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedBy    String   @map("updated_by")
  updatedAt    DateTime @updatedAt @map("updated_at")

  items       OrderItem[]

  @@map("product")
  @@schema("pos")
}

model Order {
  id         String      @id @default(cuid()) 
  customerId String      @map("customer_id")
  customer   Customer    @relation(fields: [customerId], references: [id])
  status     OrderStatus
  amountPaid  Float      @default(0) @map("amount_paid")
  paymentType PaymentType @map("payment_type")
  createdBy    String   @map("created_by")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedBy    String   @map("updated_by")
  updatedAt    DateTime @updatedAt @map("updated_at")

  items      OrderItem[]

  @@map("order")
  @@schema("pos")
}

model OrderItem {
  id           String   @id @default(cuid())
  orderId      String   @map("order_id")
  productId    String   @map("product_id")
  quantity     Int
  createdAt    DateTime @default(now()) @map("created_at")
  createdBy    String   @map("created_by")
  discount     Float?
  discountCode String?
  price        Float
  updatedAt    DateTime @updatedAt @map("updated_at")
  updatedBy    String   @map("updated_by")
  order        Order    @relation(fields: [orderId], references: [id])
  product      Product  @relation(fields: [productId], references: [id])

  @@map("order_item")
  @@schema("pos")
}

model DiscountCode {
  id           String   @id @default(cuid())
  discountCode String   @map("discount_code")
  description  String
  applicableTo String   @default("order-line") @map("applicable_to")
  discount     Float
  discountType String   @default("amount") @map("discount_type")
  createdBy    String   @map("created_by")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedBy    String   @map("updated_by")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("discount_code")
  @@schema("pos")
}

enum OrderStatus {
  PENDING
  COMPLETED
  CANCELED

  @@map("enum_order_status")
   @@schema("public")
}

enum ProductStatus {
  ACTIVE
  DRAFT
  ARCHIVED

  @@map("enum_product_status")
  @@schema("public")
}

enum PaymentType {
  CASH
  CARD
  CHECK
  OTHER

  @@map("enum_payment_type")
  @@schema("public")
}

enum UserPrimaryRole {
  SUPERADMIN
  ADMIN
  USER

  @@map("enum_user_primary_role")
  @@schema("public")
}

